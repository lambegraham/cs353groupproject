/**
 * Copyright 2014 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/// <reference types="node" />
import { GoogleAuth, GoogleAuthOptions ***REMOVED*** from 'google-auth-library';
import { CredentialBody ***REMOVED*** from 'google-auth-library';
import * as r from 'teeny-request';
import { Duplex, DuplexOptions, Readable, Writable ***REMOVED*** from 'stream';
import { Interceptor ***REMOVED*** from './service-object';
export declare type ResponseBody = any;
export interface DuplexifyOptions extends DuplexOptions {
    autoDestroy?: boolean;
    end?: boolean;
***REMOVED***
export interface Duplexify extends Duplex {
    readonly destroyed: boolean;
    setWritable(writable: Writable | false | null): void;
    setReadable(readable: Readable | false | null): void;
***REMOVED***
export interface DuplexifyConstructor {
    obj(writable?: Writable | false | null, readable?: Readable | false | null, options?: DuplexifyOptions): Duplexify;
    new (writable?: Writable | false | null, readable?: Readable | false | null, options?: DuplexifyOptions): Duplexify;
    (writable?: Writable | false | null, readable?: Readable | false | null, options?: DuplexifyOptions): Duplexify;
***REMOVED***
export interface ParsedHttpRespMessage {
    resp: r.Response;
    err?: ApiError;
***REMOVED***
export interface MakeAuthenticatedRequest {
    (reqOpts: DecorateRequestOptions): Duplexify;
    (reqOpts: DecorateRequestOptions, options?: MakeAuthenticatedRequestOptions): void | Abortable;
    (reqOpts: DecorateRequestOptions, callback?: BodyResponseCallback): void | Abortable;
    (reqOpts: DecorateRequestOptions, optionsOrCallback?: MakeAuthenticatedRequestOptions | BodyResponseCallback): void | Abortable | Duplexify;
    getCredentials: (callback: (err?: Error | null, credentials?: CredentialBody) => void) => void;
    authClient: GoogleAuth;
***REMOVED***
export interface Abortable {
    abort(): void;
***REMOVED***
export declare type AbortableDuplex = Duplexify & Abortable;
export interface PackageJson {
    name: string;
    version: string;
***REMOVED***
export interface MakeAuthenticatedRequestFactoryConfig extends GoogleAuthOptions {
    /**
     * Automatically retry requests if the response is related to rate limits or
     * certain intermittent server errors. We will exponentially backoff
     * subsequent requests by default. (default: true)
     */
    autoRetry?: boolean;
    /**
     * If true, just return the provided request options. Default: false.
     */
    customEndpoint?: boolean;
    /**
     * Account email address, required for PEM/P12 usage.
     */
    email?: string;
    /**
     * Maximum number of automatic retries attempted before returning the error.
     * (default: 3)
     */
    maxRetries?: number;
    stream?: Duplexify;
    /**
     * A pre-instantiated GoogleAuth client that should be used.
     * A new will be created if this is not set.
     */
    authClient?: GoogleAuth;
***REMOVED***
export interface MakeAuthenticatedRequestOptions {
    onAuthenticated: OnAuthenticatedCallback;
***REMOVED***
export interface OnAuthenticatedCallback {
    (err: Error | null, reqOpts?: DecorateRequestOptions): void;
***REMOVED***
export interface GoogleErrorBody {
    code: number;
    errors?: GoogleInnerError[];
    response: r.Response;
    message?: string;
***REMOVED***
export interface GoogleInnerError {
    reason?: string;
    message?: string;
***REMOVED***
export interface MakeWritableStreamOptions {
    /**
     * A connection instance used to get a token with and send the request
     * through.
     */
    connection?: {***REMOVED***;
    /**
     * Metadata to send at the head of the request.
     */
    metadata?: {
        contentType?: string;
  ***REMOVED***
    /**
     * Request object, in the format of a standard Node.js http.request() object.
     */
    request?: r.Options;
    makeAuthenticatedRequest(reqOpts: r.OptionsWithUri, fnobj: {
        onAuthenticated(err: Error | null, authenticatedReqOpts?: r.Options): void;
  ***REMOVED***): void;
***REMOVED***
export interface DecorateRequestOptions extends r.CoreOptions {
    autoPaginate?: boolean;
    autoPaginateVal?: boolean;
    objectMode?: boolean;
    maxRetries?: number;
    uri: string;
    interceptors_?: Interceptor[];
    shouldReturnStream?: boolean;
***REMOVED***
export interface ParsedHttpResponseBody {
    body: ResponseBody;
    err?: Error;
***REMOVED***
/**
 * Custom error type for API errors.
 *
 * @param {object***REMOVED*** errorBody - Error object.
 */
export declare class ApiError extends Error {
    code?: number;
    errors?: GoogleInnerError[];
    response?: r.Response;
    constructor(errorMessage: string);
    constructor(errorBody: GoogleErrorBody);
    /**
     * Pieces together an error message by combining all unique error messages
     * returned from a single GoogleError
     *
     * @private
     *
     * @param {GoogleErrorBody***REMOVED*** err The original error.
     * @param {GoogleInnerError[]***REMOVED*** [errors] Inner errors, if any.
     * @returns {string***REMOVED***
     */
    static createMultiErrorMessage(err: GoogleErrorBody, errors?: GoogleInnerError[]): string;
***REMOVED***
/**
 * Custom error type for partial errors returned from the API.
 *
 * @param {object***REMOVED*** b - Error object.
 */
export declare class PartialFailureError extends Error {
    errors?: GoogleInnerError[];
    response?: r.Response;
    constructor(b: GoogleErrorBody);
***REMOVED***
export interface BodyResponseCallback {
    (err: Error | ApiError | null, body?: ResponseBody, res?: r.Response): void;
***REMOVED***
export interface MakeRequestConfig {
    /**
     * Automatically retry requests if the response is related to rate limits or
     * certain intermittent server errors. We will exponentially backoff
     * subsequent requests by default. (default: true)
     */
    autoRetry?: boolean;
    /**
     * Maximum number of automatic retries attempted before returning the error.
     * (default: 3)
     */
    maxRetries?: number;
    retries?: number;
    stream?: Duplexify;
    shouldRetryFn?: (response?: r.Response) => boolean;
***REMOVED***
export declare class Util {
    ApiError: typeof ApiError;
    PartialFailureError: typeof PartialFailureError;
    /**
     * No op.
     *
     * @example
     * function doSomething(callback) {
     *   callback = callback || noop;
     * ***REMOVED***
     */
    noop(): void;
    /**
     * Uniformly process an API response.
     *
     * @param {****REMOVED*** err - Error value.
     * @param {****REMOVED*** resp - Response value.
     * @param {****REMOVED*** body - Body value.
     * @param {function***REMOVED*** callback - The callback function.
     */
    handleResp(err: Error | null, resp?: r.Response | null, body?: ResponseBody, callback?: BodyResponseCallback): void;
    /**
     * Sniff an incoming HTTP response message for errors.
     *
     * @param {object***REMOVED*** httpRespMessage - An incoming HTTP response message from `request`.
     * @return {object***REMOVED*** parsedHttpRespMessage - The parsed response.
     * @param {?error***REMOVED*** parsedHttpRespMessage.err - An error detected.
     * @param {object***REMOVED*** parsedHttpRespMessage.resp - The original response object.
     */
    parseHttpRespMessage(httpRespMessage: r.Response): ParsedHttpRespMessage;
    /**
     * Parse the response body from an HTTP request.
     *
     * @param {object***REMOVED*** body - The response body.
     * @return {object***REMOVED*** parsedHttpRespMessage - The parsed response.
     * @param {?error***REMOVED*** parsedHttpRespMessage.err - An error detected.
     * @param {object***REMOVED*** parsedHttpRespMessage.body - The original body value provided
     *     will try to be JSON.parse'd. If it's successful, the parsed value will
     * be returned here, otherwise the original value and an error will be returned.
     */
    parseHttpRespBody(body: ResponseBody): ParsedHttpResponseBody;
    /**
     * Take a Duplexify stream, fetch an authenticated connection header, and
     * create an outgoing writable stream.
     *
     * @param {Duplexify***REMOVED*** dup - Duplexify stream.
     * @param {object***REMOVED*** options - Configuration object.
     * @param {module:common/connection***REMOVED*** options.connection - A connection instance used to get a token with and send the request through.
     * @param {object***REMOVED*** options.metadata - Metadata to send at the head of the request.
     * @param {object***REMOVED*** options.request - Request object, in the format of a standard Node.js http.request() object.
     * @param {string=***REMOVED*** options.request.method - Default: "POST".
     * @param {string=***REMOVED*** options.request.qs.uploadType - Default: "multipart".
     * @param {string=***REMOVED*** options.streamContentType - Default: "application/octet-stream".
     * @param {function***REMOVED*** onComplete - Callback, executed after the writable Request stream has completed.
     */
    makeWritableStream(dup: Duplexify, options: MakeWritableStreamOptions, onComplete?: Function): void;
    /**
     * Returns true if the API request should be retried, given the error that was
     * given the first time the request was attempted. This is used for rate limit
     * related errors as well as intermittent server errors.
     *
     * @param {error***REMOVED*** err - The API error to check if it is appropriate to retry.
     * @return {boolean***REMOVED*** True if the API request should be retried, false otherwise.
     */
    shouldRetryRequest(err?: ApiError): boolean;
    /**
     * Get a function for making authenticated requests.
     *
     * @param {object***REMOVED*** config - Configuration object.
     * @param {boolean=***REMOVED*** config.autoRetry - Automatically retry requests if the
     *     response is related to rate limits or certain intermittent server
     * errors. We will exponentially backoff subsequent requests by default.
     * (default: true)
     * @param {object=***REMOVED*** config.credentials - Credentials object.
     * @param {boolean=***REMOVED*** config.customEndpoint - If true, just return the provided request options. Default: false.
     * @param {string=***REMOVED*** config.email - Account email address, required for PEM/P12 usage.
     * @param {number=***REMOVED*** config.maxRetries - Maximum number of automatic retries attempted before returning the error. (default: 3)
     * @param {string=***REMOVED*** config.keyFile - Path to a .json, .pem, or .p12 keyfile.
     * @param {array***REMOVED*** config.scopes - Array of scopes required for the API.
     */
    makeAuthenticatedRequestFactory(config: MakeAuthenticatedRequestFactoryConfig): MakeAuthenticatedRequest;
    /**
     * Make a request through the `retryRequest` module with built-in error
     * handling and exponential back off.
     *
     * @param {object***REMOVED*** reqOpts - Request options in the format `request` expects.
     * @param {object=***REMOVED*** config - Configuration object.
     * @param {boolean=***REMOVED*** config.autoRetry - Automatically retry requests if the
     *     response is related to rate limits or certain intermittent server
     * errors. We will exponentially backoff subsequent requests by default.
     * (default: true)
     * @param {number=***REMOVED*** config.maxRetries - Maximum number of automatic retries
     *     attempted before returning the error. (default: 3)
     * @param {object=***REMOVED*** config.request - HTTP module for request calls.
     * @param {function***REMOVED*** callback - The callback function.
     */
    makeRequest(reqOpts: DecorateRequestOptions, config: MakeRequestConfig, callback: BodyResponseCallback): void | Abortable;
    /**
     * Decorate the options about to be made in a request.
     *
     * @param {object***REMOVED*** reqOpts - The options to be passed to `request`.
     * @param {string***REMOVED*** projectId - The project ID.
     * @return {object***REMOVED*** reqOpts - The decorated reqOpts.
     */
    decorateRequest(reqOpts: DecorateRequestOptions, projectId: string): DecorateRequestOptions;
    isCustomType(unknown: any, module: string): boolean;
    /**
     * Create a properly-formatted User-Agent string from a package.json file.
     *
     * @param {object***REMOVED*** packageJson - A module's package.json file.
     * @return {string***REMOVED*** userAgent - The formatted User-Agent string.
     */
    getUserAgentFromPackageJson(packageJson: PackageJson): string;
    /**
     * Given two parameters, figure out if this is either:
     *  - Just a callback function
     *  - An options object, and then a callback function
     * @param optionsOrCallback An options object or callback.
     * @param cb A potentially undefined callback.
     */
    maybeOptionsOrCallback<T = {***REMOVED***, C = (err?: Error) => void>(optionsOrCallback?: T | C, cb?: C): [T, C];
***REMOVED***
declare const util: Util;
export { util ***REMOVED***;
