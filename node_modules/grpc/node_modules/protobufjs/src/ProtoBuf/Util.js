/**
 * @alias ProtoBuf.Util
 * @expose
 */
ProtoBuf.Util = (function() {
    "use strict";

    /**
     * ProtoBuf utilities.
     * @exports ProtoBuf.Util
     * @namespace
     */
    var Util = {***REMOVED***;

    /**
     * Flag if running in node or not.
     * @type {boolean***REMOVED***
     * @const
     * @expose
     */
    Util.IS_NODE = !!(
        typeof process === 'object' && process+'' === '[object process]' && !process['browser']
    );

    /**
     * Constructs a XMLHttpRequest object.
     * @return {XMLHttpRequest***REMOVED***
     * @throws {Error***REMOVED*** If XMLHttpRequest is not supported
     * @expose
     */
    Util.XHR = function() {
        // No dependencies please, ref: http://www.quirksmode.org/js/xmlhttp.html
        var XMLHttpFactories = [
            function () {return new XMLHttpRequest()***REMOVED***,
            function () {return new ActiveXObject("Msxml2.XMLHTTP")***REMOVED***,
            function () {return new ActiveXObject("Msxml3.XMLHTTP")***REMOVED***,
            function () {return new ActiveXObject("Microsoft.XMLHTTP")***REMOVED***
        ];
        /** @type {?XMLHttpRequest***REMOVED*** */
        var xhr = null;
        for (var i=0;i<XMLHttpFactories.length;i++) {
            try { xhr = XMLHttpFactories[i](); ***REMOVED***
            catch (e) { continue; ***REMOVED***
            break;
      ***REMOVED***
        if (!xhr)
            throw Error("XMLHttpRequest is not supported");
        return xhr;
  ***REMOVED***

    /**
     * Fetches a resource.
     * @param {string***REMOVED*** path Resource path
     * @param {function(?string)=***REMOVED*** callback Callback receiving the resource's contents. If omitted the resource will
     *   be fetched synchronously. If the request failed, contents will be null.
     * @return {?string|undefined***REMOVED*** Resource contents if callback is omitted (null if the request failed), else undefined.
     * @expose
     */
    Util.fetch = function(path, callback) {
        if (callback && typeof callback != 'function')
            callback = null;
        if (Util.IS_NODE) {
            var fs = require("fs");
            if (callback) {
                fs.readFile(path, function(err, data) {
                    if (err)
                        callback(null);
                    else
                        callback(""+data);
              ***REMOVED***);
          ***REMOVED*** else
                try {
                    return fs.readFileSync(path);
              ***REMOVED*** catch (e) {
                    return null;
              ***REMOVED***
      ***REMOVED*** else {
            var xhr = Util.XHR();
            xhr.open('GET', path, callback ? true : false);
            // xhr.setRequestHeader('User-Agent', 'XMLHTTP/1.0');
            xhr.setRequestHeader('Accept', 'text/plain');
            if (typeof xhr.overrideMimeType === 'function') xhr.overrideMimeType('text/plain');
            if (callback) {
                xhr.onreadystatechange = function() {
                    if (xhr.readyState != 4) return;
                    if (/* remote */ xhr.status == 200 || /* local */ (xhr.status == 0 && typeof xhr.responseText === 'string'))
                        callback(xhr.responseText);
                    else
                        callback(null);
              ***REMOVED***
                if (xhr.readyState == 4)
                    return;
                xhr.send(null);
          ***REMOVED*** else {
                xhr.send(null);
                if (/* remote */ xhr.status == 200 || /* local */ (xhr.status == 0 && typeof xhr.responseText === 'string'))
                    return xhr.responseText;
                return null;
          ***REMOVED***
      ***REMOVED***
  ***REMOVED***

    /**
     * Converts a string to camel case.
     * @param {string***REMOVED*** str
     * @returns {string***REMOVED***
     * @expose
     */
    Util.toCamelCase = function(str) {
        return str.replace(/_([a-zA-Z])/g, function ($0, $1) {
            return $1.toUpperCase();
      ***REMOVED***);
  ***REMOVED***
    
    return Util;
***REMOVED***)();
