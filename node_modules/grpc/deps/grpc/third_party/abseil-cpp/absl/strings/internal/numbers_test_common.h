// Copyright 2017 The Abseil Authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      https://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// This file contains common things needed by numbers_test.cc,
// numbers_legacy_test.cc and numbers_benchmark.cc.

#ifndef ABSL_STRINGS_INTERNAL_NUMBERS_TEST_COMMON_H_
#define ABSL_STRINGS_INTERNAL_NUMBERS_TEST_COMMON_H_

#include <array>
#include <cstdint>
#include <limits>
#include <string>

namespace absl {
namespace strings_internal {

template <typename IntType>
inline bool Itoa(IntType value, int base, std::string* destination) {
  destination->clear();
  if (base <= 1 || base > 36) {
    return false;
***REMOVED***

  if (value == 0) {
    destination->push_back('0');
    return true;
***REMOVED***

  bool negative = value < 0;
  while (value != 0) {
    const IntType next_value = value / base;
    // Can't use std::abs here because of problems when IntType is unsigned.
    int remainder = value > next_value * base ? value - next_value * base
                                              : next_value * base - value;
    char c = remainder < 10 ? '0' + remainder : 'A' + remainder - 10;
    destination->insert(0, 1, c);
    value = next_value;
***REMOVED***

  if (negative) {
    destination->insert(0, 1, '-');
***REMOVED***
  return true;
***REMOVED***

struct uint32_test_case {
  const char* str;
  bool expect_ok;
  int base;  // base to pass to the conversion function
  uint32_t expected;
***REMOVED***;

inline const std::array<uint32_test_case, 27>& strtouint32_test_cases() {
  static const std::array<uint32_test_case, 27> test_cases{{
      {"0xffffffff", true, 16, (std::numeric_limits<uint32_t>::max)()***REMOVED***,
      {"0x34234324", true, 16, 0x34234324***REMOVED***,
      {"34234324", true, 16, 0x34234324***REMOVED***,
      {"0", true, 16, 0***REMOVED***,
      {" \t\n 0xffffffff", true, 16, (std::numeric_limits<uint32_t>::max)()***REMOVED***,
      {" \f\v 46", true, 10, 46***REMOVED***,  // must accept weird whitespace
      {" \t\n 72717222", true, 8, 072717222***REMOVED***,
      {" \t\n 072717222", true, 8, 072717222***REMOVED***,
      {" \t\n 072717228", false, 8, 07271722***REMOVED***,
      {"0", true, 0, 0***REMOVED***,

      // Base-10 version.
      {"34234324", true, 0, 34234324***REMOVED***,
      {"4294967295", true, 0, (std::numeric_limits<uint32_t>::max)()***REMOVED***,
      {"34234324 \n\t", true, 10, 34234324***REMOVED***,

      // Unusual base
      {"0", true, 3, 0***REMOVED***,
      {"2", true, 3, 2***REMOVED***,
      {"11", true, 3, 4***REMOVED***,

      // Invalid uints.
      {"", false, 0, 0***REMOVED***,
      {"  ", false, 0, 0***REMOVED***,
      {"abc", false, 0, 0***REMOVED***,  // would be valid hex, but prefix is missing
      {"34234324a", false, 0, 34234324***REMOVED***,
      {"34234.3", false, 0, 34234***REMOVED***,
      {"-1", false, 0, 0***REMOVED***,
      {"   -123", false, 0, 0***REMOVED***,
      {" \t\n -123", false, 0, 0***REMOVED***,

      // Out of bounds.
      {"4294967296", false, 0, (std::numeric_limits<uint32_t>::max)()***REMOVED***,
      {"0x100000000", false, 0, (std::numeric_limits<uint32_t>::max)()***REMOVED***,
      {nullptr, false, 0, 0***REMOVED***,
***REMOVED******REMOVED***;
  return test_cases;
***REMOVED***

struct uint64_test_case {
  const char* str;
  bool expect_ok;
  int base;
  uint64_t expected;
***REMOVED***;

inline const std::array<uint64_test_case, 34>& strtouint64_test_cases() {
  static const std::array<uint64_test_case, 34> test_cases{{
      {"0x3423432448783446", true, 16, int64_t{0x3423432448783446***REMOVED******REMOVED***,
      {"3423432448783446", true, 16, int64_t{0x3423432448783446***REMOVED******REMOVED***,

      {"0", true, 16, 0***REMOVED***,
      {"000", true, 0, 0***REMOVED***,
      {"0", true, 0, 0***REMOVED***,
      {" \t\n 0xffffffffffffffff", true, 16,
       (std::numeric_limits<uint64_t>::max)()***REMOVED***,

      {"012345670123456701234", true, 8, int64_t{012345670123456701234***REMOVED******REMOVED***,
      {"12345670123456701234", true, 8, int64_t{012345670123456701234***REMOVED******REMOVED***,

      {"12845670123456701234", false, 8, 0***REMOVED***,

      // Base-10 version.
      {"34234324487834466", true, 0, int64_t{34234324487834466***REMOVED******REMOVED***,

      {" \t\n 18446744073709551615", true, 0,
       (std::numeric_limits<uint64_t>::max)()***REMOVED***,

      {"34234324487834466 \n\t ", true, 0, int64_t{34234324487834466***REMOVED******REMOVED***,

      {" \f\v 46", true, 10, 46***REMOVED***,  // must accept weird whitespace

      // Unusual base
      {"0", true, 3, 0***REMOVED***,
      {"2", true, 3, 2***REMOVED***,
      {"11", true, 3, 4***REMOVED***,

      {"0", true, 0, 0***REMOVED***,

      // Invalid uints.
      {"", false, 0, 0***REMOVED***,
      {"  ", false, 0, 0***REMOVED***,
      {"abc", false, 0, 0***REMOVED***,
      {"34234324487834466a", false, 0, 0***REMOVED***,
      {"34234487834466.3", false, 0, 0***REMOVED***,
      {"-1", false, 0, 0***REMOVED***,
      {"   -123", false, 0, 0***REMOVED***,
      {" \t\n -123", false, 0, 0***REMOVED***,

      // Out of bounds.
      {"18446744073709551616", false, 10, 0***REMOVED***,
      {"18446744073709551616", false, 0, 0***REMOVED***,
      {"0x10000000000000000", false, 16,
       (std::numeric_limits<uint64_t>::max)()***REMOVED***,
      {"0X10000000000000000", false, 16,
       (std::numeric_limits<uint64_t>::max)()***REMOVED***,  // 0X versus 0x.
      {"0x10000000000000000", false, 0, (std::numeric_limits<uint64_t>::max)()***REMOVED***,
      {"0X10000000000000000", false, 0,
       (std::numeric_limits<uint64_t>::max)()***REMOVED***,  // 0X versus 0x.

      {"0x1234", true, 16, 0x1234***REMOVED***,

      // Base-10 std::string version.
      {"1234", true, 0, 1234***REMOVED***,
      {nullptr, false, 0, 0***REMOVED***,
***REMOVED******REMOVED***;
  return test_cases;
***REMOVED***

***REMOVED***  // namespace strings_internal
***REMOVED***  // namespace absl

#endif  // ABSL_STRINGS_INTERNAL_NUMBERS_TEST_COMMON_H_
